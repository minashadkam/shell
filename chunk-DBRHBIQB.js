var j=Object.defineProperty,$=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var h=(e,t,o)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,i=(e,t)=>{for(var o in t||={})_.call(t,o)&&h(e,o,t[o]);if(w)for(var o of w(t))P.call(t,o)&&h(e,o,t[o]);return e},l=(e,t)=>$(e,U(t));var a=(e,t,o)=>new Promise((r,n)=>{var s=c=>{try{u(o.next(c))}catch(f){n(f)}},m=c=>{try{u(o.throw(c))}catch(f){n(f)}},u=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,m);u((o=o.apply(e,t)).next())});function E(e,t){return{imports:i(i({},e.imports),t.imports),scopes:i(i({},e.scopes),t.scopes)}}var N="__NATIVE_FEDERATION__",x=globalThis;x[N]??={externals:new Map,remoteNamesToRemote:new Map,baseUrlToRemoteNames:new Map};var d=x[N],I=d.externals;function R(e){return`${e.packageName}@${e.version}`}function z(e){let t=R(e);return I.get(t)}function M(e,t){let o=R(e);I.set(o,t)}function y(e){let t=e.split("/");return t.pop(),t.join("/")}function p(e,t){for(;e.endsWith("/");)e=e.substring(0,e.length-1);return t.startsWith("./")&&(t=t.substring(2,t.length)),`${e}/${t}`}var b=d.remoteNamesToRemote,g=d.baseUrlToRemoteNames;function B(e,t){b.set(e,t),g.set(t.baseUrl,e)}function K(e){return g.get(e)}function v(e){return g.has(e)}function A(e){return b.get(e)}function k(e){document.head.appendChild(Object.assign(document.createElement("script"),{type:"importmap-shim",innerHTML:JSON.stringify(e)}))}function G(){return a(this,arguments,function*(e={}){let t=typeof e=="string"?yield C(e):e,o=yield J(),r=yield D(t),n=E(o,r);return k(n),n})}function C(e){return a(this,null,function*(){return yield fetch(e).then(t=>t.json())})}function D(e){return a(this,null,function*(){let t=Object.keys(e).map(n=>a(this,null,function*(){try{let s=e[n];return yield T(s,n)}catch{return console.error(`Error loading remote entry for ${n} from file ${e[n]}`),null}}));return(yield Promise.all(t)).reduce((n,s)=>s?E(n,s):n,{imports:{},scopes:{}})})}function T(e,t){return a(this,null,function*(){let o=y(e),r=yield F(e);t||(t=r.name);let n=H(r,t,o);return B(t,l(i({},r),{baseUrl:o})),n})}function H(e,t,o){let r=W(e,t,o),n=S(e,o);return{imports:r,scopes:n}}function F(e){return a(this,null,function*(){return yield fetch(e).then(o=>o.json())})}function S(e,t){let o={},r={};for(let n of e.shared){let s=z(n)??p(t,n.outFileName);M(n,s),r[n.packageName]=s}return o[t+"/"]=r,o}function W(e,t,o){let r={};for(let n of e.exposes){let s=p(t,n.key),m=p(o,n.outFileName);r[s]=m}return r}function J(){return a(this,null,function*(){let e=yield F("./remoteEntry.json"),t=e.shared.reduce((o,r)=>l(i({},o),{[r.packageName]:"./"+r.outFileName}),{});for(let o of e.shared)M(o,"./"+o.outFileName);return{imports:t,scopes:{}}})}function Q(e,t){return a(this,null,function*(){let o=V(e,t);yield O(o);let r=L(o),n=A(r);if(!n)throw new Error("unknown remote "+r);let s=n.exposes.find(c=>c.key===o.exposedModule);if(!s)throw new Error(`Unknown exposed module ${o.exposedModule} in remote ${r}`);let m=p(n.baseUrl,s.outFileName);return yield importShim(m)})}function L(e){let t;if(e.remoteName)t=e.remoteName;else if(e.remoteEntry){let o=y(e.remoteEntry);t=K(o)}else throw new Error("unexpcted arguments: Please pass remoteName or remoteEntry");if(!t)throw new Error("unknown remoteName "+t);return t}function O(e){return a(this,null,function*(){if(e.remoteEntry&&!v(y(e.remoteEntry))){let t=yield T(e.remoteEntry);k(t)}})}function V(e,t){let o;if(typeof e=="string"&&t)o={remoteName:e,exposedModule:t};else if(typeof e=="object"&&!t)o=e;else throw new Error("unexpected arguments: please pass options or a remoteName/exposedModule-pair");return o}export{G as a,Q as b};
